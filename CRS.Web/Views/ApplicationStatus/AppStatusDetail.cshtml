@*@using CRS.BusinessEntities*@
@{
	ViewBag.Title = "Application Status File Upload Test";
}

@section styles {
 <link href="@Url.Content("~/Content/themes/dark-hive/jquery-ui.css")" rel="stylesheet" type="text/css" />
<!-- Demo styles -->
@*<link href="@Url.Content("~/Content/FileUpload/demo.css")" rel="stylesheet" type="text/css" />*@
<!--[if lte IE 8]>
<link href="@Url.Content("~/Content/FileUpload/demo-ie8.css")" rel="stylesheet" type="text/css" />
<![endif]-->

<link href="@Url.Content("~/Content/themes/base/minified/jquery-ui.min.css")" rel="stylesheet" type="text/css" />
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="@Url.Content("~/Content/FileUpload/jquery.fileupload-ui.css")" type="text/css"/>
<!-- CSS adjustments for browsers with JavaScript disabled -->

<noscript><link rel="stylesheet" href="@Url.Content("~/Content/FileUpload/jquery.fileupload-ui-noscript.css")"/></noscript>

@* 
 <link href="@Url.Content("~/Content/Bootstrap/bootstrap.min.css")" rel="stylesheet" type="text/css" />
 <link href="@Url.Content("~/Content/Bootstrap/bootstrap-responsive.min.css")" rel="stylesheet" type="text/css" />
 <link href="@Url.Content("~/Content/Bootstrap/bootstrap-image-gallery.min.css")" rel="stylesheet" type="text/css" />
 <link href="@Url.Content("~/Content/FileUpload/jquery.fileupload-ui.css")" rel="stylesheet" type="text/css" />*@
       <style type="text/css">
		#tblSearchFilter td {
			background-color: transparent;
			border: medium none !important;
			font-size: 14px;
			width: 200px;
		}
		
	   .contentHolder  .dataTables_filter  input {
			float: right;
			margin: 0 0 0 0 ;
		}
		.contentHolder .dataTables_filter label {
			float: none;
		}
		.compactRadioGroup LABEL,
		 .compactRadioGroup INPUT {
			display: inline !important;
			width: auto !important; 
			margin-right: 5px;  
			margin-left: 5px;   
		}

		.labelInline {
			clear:both;
		}
		.selectInline {
			float:left;
		}
		.dropdownDate 
		{
			  display:inline-block;
			  margin:0 10px 10px 0;
			  *display:inline;
			  zoom:1;
		} 

        .ui-widget {
            font-size: 0.95em;
        }

        /*popup*/ 
        fieldset { padding:0; border:0; margin-top:25px; }
        h1 { font-size: 1.2em; margin: .6em 0; }
        div#users-contain { width: 350px; margin: 20px 0; }
        div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
        div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
        .ui-dialog .ui-state-error { padding: .3em; }
        .validateTips { border: 1px solid transparent; padding: 0.3em; }
	</style>
 
   
}

@section featured {
	<section class="featured">
		<div class="content-wrapper">
			<hgroup class="title">
				<h1>@ViewBag.Title.</h1>
				
			</hgroup>
		</div>
	</section>
}

@section jquerylibrary{
	 <script src= "@Url.Content("~/Scripts/jquery-2.0.2.min.js")" type="text/javascript"></script>
}

@section scripts {
		<script src="@Url.Content("~/Scripts/knockout-2.2.1.js")" type="text/javascript"></script>
		@Scripts.Render("~/bundles/ajaxwrapper")
		@Scripts.Render("~/bundles/koMappings")
		@Scripts.Render("~/bundles/koBindings")
		<script src="@Url.Content("~/Scripts/jquery.maskedinput-1.3.1.min.js")" type="text/javascript"></script>
		<script src="@Url.Content("~/Scripts/jquery.filter_input.js")" type="text/javascript"></script>
		<script src="@Url.Content("~/Scripts/Application/ApplicationStatus.js")" type="text/javascript"></script>
		<script src="@Url.Content("~/Scripts/jquery.blockUI.min.js")" type="text/javascript"></script>
       
        <script src="@Url.Content("~/Content/FileUpload/tmpl.min.js")" type="text/javascript"></script> 	
               <script src="@Url.Content("~/Content/FileUpload/load-image.min.js")" type="text/javascript"></script> 	
        <script src="@Url.Content("~/Content/FileUpload/canvas-to-blob.min.js")" type="text/javascript"></script> 	
   
       @* <script src="@Url.Content("~/Content/Bootstrap/bootstrap-image-gallery.min.js")" type="text/javascript"></script> 	
        <script src="@Url.Content("~/Content/Bootstrap/bootstrap.js")" type="text/javascript"></script>     *@
        <script src="@Url.Content("~/Content/FileUpload/jquery.iframe-transport.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload.js")" type="text/javascript"></script>    
        <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload-process.js")" type="text/javascript"></script>
        
        <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload-image.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload-audio.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload-video.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload-validate.js")" type="text/javascript"></script>

        <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload-ip.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload-ui.js")" type="text/javascript"></script>
     <script src="@Url.Content("~/Content/FileUpload/jquery.fileupload-jquery-ui.js")" type="text/javascript"></script>
@*        <script src="@Url.Content("~/Content/FileUpload/locale.js")" type="text/javascript"></script>*@
            

        <script src="@Url.Content("~/Content/FileUpload/main.js")" type="text/javascript"></script>
        <script Id="summaryTemplate" type="text/html">
			<td>
				<span data-bind="text: SourceCode" />
			</td>
			<td>
				<span data-bind="text: CardType" />
			</td>
			<td>
				<span data-bind="text: CardBrand" />
			</td>
			<td>
				<span data-bind="text: Status" />
			</td>
			<td>
				<span data-bind="text: DateStatus" />
			</td>
            <td>
                <span data-bind="text: ReferrorName" />
            </td>
            <td>
                <span data-bind="text: ReferrorCode" />
            </td>
			<td>
				<span data-bind="text: ApplicationCount" />
			</td>
	</script> 
	<script Id="detailTemplate" type="text/html">
			<td>
				<span data-bind="text: SourceCode" />
			</td>
			<td>
				<span data-bind="text: ApplicationNo" />
			</td>
			<td>
				<span data-bind="text: FullName" />
			</td>
			<td>
				<span data-bind="text: CardType" />
			</td>
			<td>
				<span data-bind="text: CardBrand" />
			</td>
			<td>
				<span data-bind="text: DateEncoded" />
			</td>
			<td>
                <div data-bind="visible: Status != 'Incomplete'"">
                   <span data-bind="text: Status"  />
                </div>
                <div  data-bind="click: $parent.showApplicationStatus, visible: Status == 'Incomplete'">
                    <a id="lnkAppStatus" href="#" data-bind="text: Status"></a>
                </div>
   			</td>
			<td>
				<span data-bind="text: DateStatus" />
			</td>
            <td>
                <span data-bind="text: ReferrorName" />
            </td>
            <td>
                <span data-bind="text: ReferrorCode" />
            </td>
	</script>    
}
<div id="applicationStatusSearch" data-bind="visible: isUser" >
	<div class="columnBox2">
		<div>
			<label>Mode:</label>
			
				<div class="compactRadioGroup">
					<input type='radio' name='onlyOne' id="summary" data-bind='checked: isSummary' value=true /> 
					<label for="summary">Summary</label>
					<input type='radio'  name='onlyOne' id="detail" data-bind='checked: isSummary' value=false  />
					<label for="detail">Detail</label>
				</div>
			
		</div>

		<div>
			<label for="ddReport">Type:</label>	
			
			<div class="shortCombo">
				<select name="ddReport" data-bind="options: reportList, optionsText: 'Name', optionsValue: 'Code', value: selectedReport"></select>
			</div>

		</div>

		<div>
		   <label>Source Code:</label>
		   <input type="text" id="txtSourceCode" maxlength="13" data-bind="value: sourceCode" />
		
		</div>
        <div>
			 <label>Card Brand:</label>
			 <div class="shortCombo">
						<select data-bind="options: cardBrandList,
    optionsText: 'CardBrandName',
    optionsValue: 'CardBrandCode',
    value: selectedCardBrand,
    optionsCaption: '-- All --'" ></select>
			</div>
		</div>

		<div>
			<label>Name:</label>
			<input type="text" id="txtName" maxlength="50" data-bind="value: searchName" /> 
		</div>
	  
	</div>


	 <div class="columnBox2">
		 <div></div>
		 @*<div>for steve this is the first field</div>*@
		 <div>
				<div class="daily">
					<label for="dailyDate" class="daily">Start:</label>
					<input type="text" name="dailyDate" class="daily" id="dtDaily" data-bind="value: dateFrom" />
				</div>
				<div class="weekly">
					<label for="startDate" class="weekly">Start:</label>
					<input id="dtWeeklyFrom" class="weekly" data-bind="datepicker: dtWeeklyFrom, datepickerOptions: {
    showOn: 'button',
    buttonImage: '../Content/images/calendar-icon.png',
    buttonImageOnly: true,
    beforeShowDay: allowedDays,
    onSelect: setWeeklyDate,
    maxDate: '-1d'
}" />
				</div>
				<div class="others">
					<label for="othersDateFrom" class="others">Start:</label>
					<input name="othersDateFrom" id="dtOthersFrom" class="others" data-bind="datepicker: dtOthersFrom, datepickerOptions: {
    showOn: 'button',
    buttonImage: '../Content/images/calendar-icon.png',
    buttonImageOnly: true,
    maxDate: '-1d'
}" />
				</div> 
				<div class="monthly">
					<label>Month:</label>
					<div class="shortCombo">
						<select data-bind="options: monthsList,
    optionsText: 'Name',
    optionsValue: 'Code',
    value: selectedMonth" ></select>
					</div>
				</div>
				<div class="quarterly">
					<label>Quarter:</label>
					<div class="shortCombo">
						<select data-bind="options: quarterList,
    optionsText: 'Name',
    optionsValue: 'Code',
    value: selectedQuarter" ></select>
					</div>
				</div>
				<div class="yearly">
					<label>Year:</label>
					<div class="shortCombo">
						<select data-bind="options: yearsList,
    optionsText: 'Name',
    optionsValue: 'Code',
    value: selectedYear" ></select>
					</div>
				</div>
		</div>
		 <div>
			<label>Referror:</label>
			<input type="text" id="txtReferrorName" maxlength="20"  data-bind="value: referrorName" /> 
		</div>
        <div>
			 <label>Card Type:</label>
			 <div class="shortCombo">
						<select data-bind="options: cardTypeList,
    optionsText: 'CardTypeName',
    optionsValue: 'CardTypeCode',
    value: selectedCardType,
    optionsCaption: '-- All --'" ></select>
			</div>
		</div>
    	<div>
			 <label>Status:</label>
			 <div class="shortCombo">
						 <select data-bind="options: statusList,
    optionsText: 'StatusName',
    optionsValue: 'StatusCode',
    value: selectedStatus,
    optionsCaption: '-- All --'" ></select>
			</div>
		</div>
	 </div>

	<div class="columnBox2">
		<div></div>
		@*<div>for steve this is the second field</div>*@
		<div>
			<div class="weekly">
				<label for="endDate" class="weekly">End:</label>
				<input id="dtWeeklyTo" class="weekly" data-bind="enable: false, datepicker: dtWeeklyTo, datepickerOptions: {
    showOn: 'button',
    buttonImage: '../Content/images/calendar-icon.png',
    buttonImageOnly: true,
}" />
			</div>
			<div class="others">
				<label for="othersDateTo" class="others">End:</label>
				<input name="othersDateTo" id="dtOthersTo" class="others" data-bind="datepicker: dtOthersTo, datepickerOptions: {
    showOn: 'button',
    buttonImage: '../Content/images/calendar-icon.png',
    buttonImageOnly: true,
    maxDate: '-1d'
}" />
			</div>
			<div class="monthly">
					<label>Year:</label>
					<div class="shortCombo">
						<select data-bind="options: yearsList,
    optionsText: 'Name',
    optionsValue: 'Code',
    value: selectedYear" ></select>
					</div>
			</div>
			 <div class="quarterly">
					<label>Year:</label>
					<div class="shortCombo">
						<select data-bind="options: yearsList,
    optionsText: 'Name',
    optionsValue: 'Code',
    value: selectedYear" ></select>
					</div>
			</div>
		</div>
		<div>
			<label style="width: 120px">Application Number:</label>
			<input type="text" id="txtApplicationNumber" maxlength="20"  data-bind="value: applicationNo" /> 
		</div>
	</div>
</div>
<div class="clear"></div>
<button data-bind="click: searchAppStatus, visible: isUser" style="margin-top:10px; margin-bottom:10px">
					<strong>Search</strong>
</button>      
<div  class="float-left">
@* Knockout js and datatable approach  *@
<div id="demo">
	<div id="tblDetail">
			<table cellpadding="0" cellspacing="0" border="0" class="display" id="appStatuslisttableSummary"
					data-bind = "        dataTable: {
            dataSource: detailList,
            rowTemplate: 'detailTemplate',
            columns: ['SourceCode', 'ApplicationNo', 'FullName', 'CardType', 'CardBrand',
                      'DateEncoded', 'Status', 'DateStatus', 'ReferrorName', 'ReferrorCode'],
            options: {
                bJQueryUI: true,
                bPaginate: true,
                bLengthChange: true,
                bFilter: true,
                bSort: true,
                bInfo: true,
                bAutoWidth: true,
                bProcessing: true,
                sPaginationType: 'full_numbers'
            }
        }"> 
						<thead> 
						<tr class="gradeX">
							<th>Source Code</th>
							<th>Application No</th>
							<th>Name</th>
							<th>Card Type</th>
							<th>Card Brand</th>			
							<th>Date Encoded</th>
							<th>Status</th>
							<th>Status Date</th>
                            <th>Referror</th>
                            <th>Code</th>		
						</tr>
						</thead> 
						<tbody>
	
						</tbody>
				</table>
		</div>
		<div id="tblSummary">
			<table cellpadding="0" cellspacing="0" border="0" class="display" id="appStatuslisttableDetail"
					data-bind = "dataTable: {
    dataSource: summaryList,
    rowTemplate: 'summaryTemplate',
    columns: ['SourceCode', 'CardType', 'CardBrand', 'Status', 'DateStatus',
              'ReferrorName', 'ReferrorCode', 'ApplicationCount', ],
    options: {
        bJQueryUI: true,
        bPaginate: true,
        bLengthChange: true,
        bFilter: true,
        bSort: true,
        bInfo: true,
        bAutoWidth: true,
        bProcessing: true,
        sPaginationType: 'full_numbers'
    }
}"> 
										<thead> 
										<tr class="gradeX">
											<th>Source Code</th>
											<th>Card Type</th>
											<th>Card Brand </th>
											<th>Status</th>
											<th>Status Date</th>
                                            <th>Referror</th>
                                            <th>Code</th>
										    <th>Count</th>
										</tr>
										</thead> 
										<tbody>
										</tbody>
										
			</table>
		</div>
	</div>
	<br />
	<div align="center">
		<button data-bind="click: getReportData, visible: showPrint" style="margin-top:10px; margin-bottom:10px">
		   <strong> Print </strong>
		</button>
	</div>
 </div>
<div style ="clear:both"></div>
<div id="dialog-form" title="Application Status">
  <p class="validateTips">Please fill up the necessary information.</p>
@*  <form>*@
  <fieldset>
    <div>
        <label for="statDesc" style="float:left">Description&nbsp;</label>
        <textarea name="statDesc" id="statDesc" data-bind="text: reasonNames, enable: false" style="height: 10em;width:100%" cols="5" rows="10"></textarea>
       </div>
    <div>
        <label for="statRem" style="float:left">Remarks&nbsp;&nbsp;&nbsp;&nbsp;</label>
         <textarea name="statRem" id="statRem" style="height: 10em;width:100%" cols="5" rows="10"></textarea>
         </div>  
  </fieldset>
 <!-- Shim to make HTML5 elements usable in older Internet Explorer versions -->
<!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->


@*IN ORDER TO USE MVC ACTIONS AS HANDLERS OF AJAX CALLS, USE THE FORM DECLARATION BELOW. (THE ONE COMMENTED OUT)
IT IS NOT ADVISED SINCE WHEN USING MVC CONTROLLER TO HANDLE REQUESTS ONE CAN'T CONTROL THE maxMessageLength OF THE POST REQUEST
THIS CASTS THE FUNCTIONALITY OF UPLOADING LARGE FILES USELESS, UNLESS YOU SUCRIFICE THE SECURITY AND ALLOW LARGE 
POST MESSAGE SIZES SITE-WIDE.

IT IS BETTER TO USE HTTP HANDLER TO PROCESS UPLOAD REQUESTS UNTIL MVC FRAMEWORK PROVIDES WAYS TO SET maxMessageLength ON
PER ACTION BASIS *@

<form id="fileupload" action="@Url.Action("UploadFiles")" method="POST" enctype="multipart/form-data">

@*<form id="fileupload" action="/Upload/UploadHandler.ashx" method="POST" enctype="multipart/form-data">*@
        <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
        <div class="fileupload-buttonbar">
        <div class="fileupload-buttons">
            <!-- The fileinput-button span is used to style the file input field as button -->
            <span class="fileinput-button">
                <span>Add files...</span>
                <input type="file" name="files[]" multiple>
            </span>
            <button type="submit" class="start">Start upload</button>
            <button type="reset" class="cancel">Cancel upload</button>
            <button type="button" class="delete">Delete</button>
            <input type="checkbox" class="toggle">
            <!-- The loading indicator is shown during file processing -->
            <span class="fileupload-loading"></span>
        </div>
        <!-- The global progress information -->
        <div class="fileupload-progress fade" style="display:none">
            <!-- The global progress bar -->
            <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
            <!-- The extended global progress information -->
            <div class="progress-extended">&nbsp;</div>
        </div>
    </div>
    <!-- The table listing the files available for upload/download -->
    <table role="presentation"><tbody class="files"></tbody></table>
    </form>
    
   
  <!-- The template to display files available for upload -->
<script id="template-upload" type="text/x-tmpl">
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade" style="display:none">
        <td>
            <span class="preview"></span>
        </td>
        <td>
            <p class="name">{%=file.name%}</p>
            {% if (file.error) { %}
                <div><span class="error">Error:</span> {%=file.error%}</div>
            {% } %}
        </td>
        <td>
            <p class="size">{%=o.formatFileSize(file.size)%}</p>
            {% if (!o.files.error) { %}
                <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
            {% } %}
        </td>
        <td>
            {% if (!o.files.error && !i && !o.options.autoUpload) { %}
                <button class="start">Start</button>
            {% } %}
            {% if (!i) { %}
                <button class="cancel">Cancel</button>
            {% } %}
        </td>
    </tr>
{% } %}
</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-download fade" style="display:none">
        <td>
            <span class="preview">
                {% if (file.thumbnailUrl) { %}
                    <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
                {% } %}
            </span>
        </td>
        <td>
            <p class="name">
                <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?'data-gallery':''%}>{%=file.name%}</a>
            </p>
            {% if (file.error) { %}
                <div><span class="error">Error</span> {%=file.error%}</div>
            {% } %}
        </td>
        <td>
            <span class="size">{%=o.formatFileSize(file.size)%}</span>
        </td>
        <td>
            <button class="delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>Delete</button>
            <input type="checkbox" name="delete" value="1" class="toggle">
        </td>
    </tr>
{% } %}
</script>
@*  </form>*@
</div>



		
		